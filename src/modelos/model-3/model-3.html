<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css2?family=Oswald&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Merriweather&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../../code-editor/codemirror-5-50-2.css" />
    <link rel="stylesheet" href="../../code-editor/editor-js.css" />
    <link rel="stylesheet" href="../../../css/styles.css" />
    <link rel="stylesheet" href="../../../css/style-sidebar.css" />
    <link rel="stylesheet" href="../../../css/art-styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.7.0/dist/tf.min.js"></script>
    <title>Modelo 3 - Clasificador Iris</title>
  </head>
  <body>
    <!-- THE HEADER - SECOND HEADER-->
    <div id="the-header">
      <header>
        <div class="second-header">
          <h1><a href="../../../index.html"> Plataforma JS </a></h1>
        </div>
      </header>
    </div>

    <!-- NAV -  BARRA NAVEGACION-->
    <div id="the-nav">
      <nav>
        <ul id="menu">
          <!--           <li><a href="../../../index.html">Home</a></li> -->
          <li class="dropdown">
            <a href="javascript:void(0)" class="dropbtn">Let's play!</a>
            <div class="dropdown-content">
              <a href="../../modelos.html">Modelos</a>
              <a href="../../editorjs.html">Editor JS</a>
            </div>
          </li>

          <li class="dropdown">
            <a href="../../tensorflowjs/index-tfjs.html" class="dropbtn"
              >TensorFlow.js</a
            >
            <!--             <div class="dropdown-content">
              <a href="../../tensorflowjs/how-works.html"
                >¿Cómo se trabaja en tfjs?</a
              >
              <a href="../../tensorflowjs/recursos.html">Otros recursos</a>
            </div> -->
          </li>

          <li>
            <a style="cursor: pointer" onclick="openNav()">&#9776; Ejemplos</a>
          </li>

          <li class="dropdown">
            <a href="javascript:void(0)" class="dropbtn">Recursos externos</a>
            <div class="dropdown-content">
              <a href="https://js.tensorflow.org/api/latest/" target="_blank"
                >Referencia API</a
              >

              <a
                href="https://github.com/tensorflow/tfjs-models"
                target="_blank"
                >Modelos tfjs</a
              >
              <a
                href="https://github.com/tensorflow/tfjs-examples/"
                target="_blank"
                >Más ejemplos tfjs</a
              >
              <a
                href="https://blog.tensorflow.org/search?label=TensorFlow.js&max-results=10"
                target="_blank"
                >Blog TensorFlow.js</a
              >
              <a href="https://playground.tensorflow.org/" target="_blank"
                >Tensorflow Playground</a
              >
              <a href="https://poloclub.github.io/ganlab/" target="_blank"
                >GAN Lab</a
              >
            </div>
          </li>
        </ul>
      </nav>
    </div>

    <!-- contenido HTML-->
    <div id="contenido-html">
      <div class="art-html">
        <h1>Dataset en CSV en TensorFlow.js</h1>

        El siguiente ejemplo es una modificación del ejemplo de
        <a href="../model-1/model-1.html">introducción a TensorFlow.js</a>. En
        este ejemplo se preseta una modificación para visualizar el
        entrenamiento de una red neuronal a través de la correcta configuración
        de **callbacks**.
        <ul>
          <li>
            <a href="#1">Descripción del modelo</a>
          </li>

          <li>
            <a href="#editorJS">Editor y ejecución del modelo</a>
          </li>
        </ul>

        <br />
        <br />
        <br />
        <hr class="rounded" />
        <hr class="rounded" />
        <br />
        <br />
        <br />
        <h2 id="1">Descripción del modelo</h2>
        <p>
          El modelo intenta predecir mediante una
          <strong> Regresión Lineal</strong> el tiempo de descarga en
          <strong> segundos</strong>
          de ciertos paquetes definidos en <strong>MB, megabytes</strong>. Para
          esto entrena una neurona y configura <strong> callbacks</strong> para
          la visualización de su entrenamiento.
        </p>
        <ol start="1">
          <li>
            Define una función asíncrona para ejecutar de forma asíncrona el
            ajuste del modelo mediante <em>model.fit()</em>.
            <ul>
              <li>
                Como tercer argumento de <em>model.fit()</em> se definen
                callbacks a ejecutar a cada término de <em>época</em>. Estos
                callbacks se definen para mostrarse a través de la consola
                (mediante <code>console.log()</code>), y muestran el
                <strong> número de época </strong> y el
                <strong> valor de la función de pérdida </strong> al final de
                cada época.
              </li>
            </ul>
          </li>
          <script src="https://emgithub.com/embed.js?target=https%3A%2F%2Fgithub.com%2Fccofres%2FplataformaJS%2Fblob%2Fmain%2Fsrc%2Fmodelos%2Fmodel-2%2Fmodel-2.js%23L1-L14&style=gruvbox-dark&showLineNumbers=on"></script>
        </ol>
      </div>
    </div>

    <!--CodeMirror Editor-->
    <h2 id="editorJS">
      Clasificador
      <a href="https://archive.ics.uci.edu/ml/datasets/iris" target="_blank"
        >Iris Dataset</a
      >
    </h2>
    <section id="static">
      <pre><code id="static-js" data-height="">async function run(){
  const csvUrl = 'iris.csv';
  const trainingData = tf.data.csv(csvUrl, {
    columnConfigs: {
      species: {
        isLabel: true}
        }
      });
  const numOfFeatures = (await trainingData.columnNames()).length - 1;
  const numOfSamples = 150;
  const convertedData =
    trainingData.map(({xs, ys}) => {
      const labels =  [
        ys.species == "setosa" ? 1 : 0,
        ys.species == "virginica" ? 1 : 0,
        ys.species == "versicolor" ? 1 : 0
      ]
      return{ xs: Object.values(xs), ys: Object.values(labels)};
    }).batch(10);
  const model = tf.sequential();
  model.add(tf.layers.dense({inputShape: [numOfFeatures], activation: "sigmoid", units: 5}));
  model.add(tf.layers.dense({activation: "softmax", units: 3}));
  model.compile({loss: "categoricalCrossentropy",
                optimizer: "adam",
              //optimizer: tf.train.adam(0.06)
                metrics: ['accuracy']});
  await model.fitDataset(convertedData,
                        {epochs:100,
                        callbacks:{
                                  onEpochEnd: async(epoch, logs) =>{
                                    console.log("Epoch: " + epoch
                                    + " Loss: " + logs.loss
                                    + " Accuracy: " + logs.acc);
                                  }
                        }});
  // Test de casos:
  // Setosa
  const testVal = tf.tensor2d([4.4, 2.9, 1.4, 0.2], [1, 4]);
  // Versicolor
  // const testVal = tf.tensor2d([6.4, 3.2, 4.5, 1.5], [1, 4]);
  // Virginica
  //const testVal = tf.tensor2d([5.8,2.7,5.1,1.9], [1, 4]);
    const prediction = model.predict(testVal);
    const pIndex = tf.argMax(prediction, axis=1).dataSync();
    const classNames = ["Setosa", "Virginica", "Versicolor"];
    // alert(prediction)
    alert(classNames[pIndex])
    //console.log(classNames[pIndex]);
}
run();
  </code></pre>
    </section>
    <section id="live" class="live hidden">
      <div id="editor" class="editor"></div>

      <div class="output-container">
        <div class="buttons-container">
          <button id="execute" class="button run" type="button">
            Run &rsaquo;
          </button>
          <button id="reset" type="button" class="button">Reset</button>
        </div>
        <div id="console" class="output">
          <code></code>
        </div>
      </div>
    </section>

    <!-- FOOTER -  PIE DE PAGINA-->
    <div id="the-footer">
      <footer>
        <p>Made with TFjs</p>
        <ul>
          <li>
            <a href="#"
              ><img src="../../../img/icon1.png" alt="Social Media 1."
            /></a>
          </li>
          <li>
            <a href="#"
              ><img src="../../../img/icon2.png" alt="Social Media 2."
            /></a>
          </li>
        </ul>
      </footer>
    </div>
    <!-- SIDENAV -->
    <nav id="mySidenav" class="sidenav"></nav>
    <!-- FIN SideNav-->
    <!-- SCROLL BUTTON -->
    <button onclick="topFunction()" id="myBtn" title="Go to top">Up!</button>
    <!-- SCROLL BUTTON -->
    <script src="../ui-sidebar.js"></script>
    <script src="../../../ui-scrollButton.js"></script>
    <script src="../../code-editor/codemirror-5-50-2.js"></script>
    <script src="../../code-editor/editor-js.js"></script>
  </body>
</html>

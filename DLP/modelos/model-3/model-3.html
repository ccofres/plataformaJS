<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Modelo 3 - Clasificador Iris</title>

    <!--
    <script src="../../codemirror/lib/codemirror.js"></script>
    <link rel="stylesheet" href="../../codemirror/lib/codemirror.css" />
    <script src="../../codemirror/mode/javascript/javascript.js"></script>
    <script src="../../codemirror/addon/edit/matchbrackets.js"></script>
    -->
    <link rel="stylesheet" href="../../code-editor/codemirror-5-50-2.css">
    <link rel="stylesheet" href="../../code-editor/editor-js.css">

    <link rel="stylesheet" href="../../../style.css" />
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.7.0/dist/tf.min.js"></script>
  </head>
  <body>
    <!--Nav top -->
    <nav class="flex-nav-top">
      <li><a href="../../../index.html">Home</a></li>
      <li>
        <a href="../../dlp.html">DLP - Playground</a>
      </li>
      <li><a href="../model.html">Modelos</a></li>
      <li>
        <a href="../../tf-playground/tfplayground.html"
          >TensorFlow Playground</a
        >
      </li>
      <li><a href="../../ganlab/ganlab.html">GAN Lab</a></li>
    </nav>
    <!-- FIN Nav top-->
    <!-- Nav left -->
    <nav class="flex-nav-left">
      <button class="btn-left">
        <a href="../model-1/model-1.html">Model 1</a>
      </button>
      <button class="btn-left"><a href="../model-2/model-2.html">Model 2</a></button>
      <button class="btn-left"><a href="./model-3.html">Clasificador Iris</a></button>
      <button class="btn-left"><a href="../model-4/model-4.html">Multiclasificador BCWD</a></button>
      <button class="btn-left"><a href="../model-5/model-5.html">Clasificador MNIST</a></button>
      <button class="btn-left"><a href="../model-6/model-6.html">Clasificador Fashion MNIST</a></button>
      <button class="btn-left"><a href="../model-7/model-7.html">Transfer Learning con MobileNet</a></button>
      <button class="btn-left"><a href="../model-8/model-8.html">Style Transfer con Magenta.js</a></button>
    </nav>
    <!-- FIN Nav left-->
    <h2> Clasificador <a href="https://archive.ics.uci.edu/ml/datasets/iris" target="_blank">Iris Dataset</a></h2>
    <!--CodeMirror Editor-->
<section id="static">
  <pre><code id="static-js" data-height="">async function run(){
  const csvUrl = 'iris.csv';
  const trainingData = tf.data.csv(csvUrl, {
    columnConfigs: {
      species: {
        isLabel: true}
        }
      });
  const numOfFeatures = (await trainingData.columnNames()).length - 1;
  const numOfSamples = 150;
  const convertedData =
    trainingData.map(({xs, ys}) => {
      const labels =  [
        ys.species == "setosa" ? 1 : 0,
        ys.species == "virginica" ? 1 : 0,
        ys.species == "versicolor" ? 1 : 0
      ]
      return{ xs: Object.values(xs), ys: Object.values(labels)};
    }).batch(10);
  const model = tf.sequential();
  model.add(tf.layers.dense({inputShape: [numOfFeatures], activation: "sigmoid", units: 5}));
  model.add(tf.layers.dense({activation: "softmax", units: 3}));
  model.compile({loss: "categoricalCrossentropy",
                optimizer: "adam",
              //optimizer: tf.train.adam(0.06)
                metrics: ['accuracy']});
  await model.fitDataset(convertedData,
                        {epochs:100,
                        callbacks:{
                                  onEpochEnd: async(epoch, logs) =>{
                                    console.log("Epoch: " + epoch
                                    + " Loss: " + logs.loss
                                    + " Accuracy: " + logs.acc);
                                  }
                        }});
  // Test de casos:
  // Setosa
  const testVal = tf.tensor2d([4.4, 2.9, 1.4, 0.2], [1, 4]);
  // Versicolor
  // const testVal = tf.tensor2d([6.4, 3.2, 4.5, 1.5], [1, 4]);
  // Virginica
  //const testVal = tf.tensor2d([5.8,2.7,5.1,1.9], [1, 4]);
    const prediction = model.predict(testVal);
    const pIndex = tf.argMax(prediction, axis=1).dataSync();
    const classNames = ["Setosa", "Virginica", "Versicolor"];
    // alert(prediction)
    alert(classNames[pIndex])
    //console.log(classNames[pIndex]);
}
run();
  </code></pre>
</section>

<section id="live" class="live hidden">
    <div id="editor" class="editor"></div>

    <div class="output-container">
        <div class="buttons-container">
            <button id="execute" class="button run" type="button">Run &rsaquo;</button>
            <button id="reset" type="button" class="button">Reset</button>
        </div>
        <div id="console" class="output">
            <code></code>
        </div>
    </div>
</section>



<script src="../../code-editor/codemirror-5-50-2.js"></script>
<script src="../../code-editor/editor-js.js"></script>
  </body>
</html>
